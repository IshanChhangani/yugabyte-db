Parsed test spec with 2 sessions

starting permutation: update_in_s1 pgss_reset update_in_s2 wait5s_s1 c1 c2 pgss_check_update_s1
step update_in_s1: UPDATE test SET v=20 WHERE k=1;
step pgss_reset: SELECT pg_stat_statements_reset();
pg_stat_statements_reset


step update_in_s2: UPDATE test SET v=40 WHERE k=1; <waiting ...>
step wait5s_s1: SELECT pg_sleep(5); <waiting ...>
step wait5s_s1: <... completed>
pg_sleep


step c1: COMMIT;
step update_in_s2: <... completed>
step c2: COMMIT;
step pgss_check_update_s1:
    SELECT rows FROM pg_stat_statements WHERE query LIKE '%UPDATE test%' and mean_time > 5000;

rows

1

starting permutation: create_function update_in_s1 explain_analyze_check_exec_time_s2 wait5s_s1 c1 c2
step create_function:
    CREATE OR REPLACE FUNCTION get_execution_time() RETURNS FLOAT
    AS $$
    DECLARE
        time_json jsonb;
        execution_time FLOAT;
    BEGIN
        EXECUTE 'EXPLAIN (ANALYZE, FORMAT JSON) UPDATE test SET v=20 WHERE k=1' INTO time_json;
        execution_time := (time_json->0->'Execution Time')::FLOAT;
        RETURN execution_time;
    END;
    $$  LANGUAGE plpgsql;

step update_in_s1: UPDATE test SET v=20 WHERE k=1;
step explain_analyze_check_exec_time_s2:
    select count(*) from (select get_execution_time() as exec_time) as func where exec_time > 5000;
 <waiting ...>
step wait5s_s1: SELECT pg_sleep(5); <waiting ...>
step wait5s_s1: <... completed>
pg_sleep


step c1: COMMIT;
step explain_analyze_check_exec_time_s2: <... completed>
count

1
step c2: COMMIT;

starting permutation: create_function update_in_s1 pgss_reset explain_analyze_s2 wait5s_s1 c1 c2 pgss_check_explain_analyze_s1
step create_function:
    CREATE OR REPLACE FUNCTION get_execution_time() RETURNS FLOAT
    AS $$
    DECLARE
        time_json jsonb;
        execution_time FLOAT;
    BEGIN
        EXECUTE 'EXPLAIN (ANALYZE, FORMAT JSON) UPDATE test SET v=20 WHERE k=1' INTO time_json;
        execution_time := (time_json->0->'Execution Time')::FLOAT;
        RETURN execution_time;
    END;
    $$  LANGUAGE plpgsql;

step update_in_s1: UPDATE test SET v=20 WHERE k=1;
step pgss_reset: SELECT pg_stat_statements_reset();
pg_stat_statements_reset


step explain_analyze_s2:
    select count(*) from (select get_execution_time() as exec_time) as func;
 <waiting ...>
step wait5s_s1: SELECT pg_sleep(5); <waiting ...>
step wait5s_s1: <... completed>
pg_sleep


step c1: COMMIT;
step explain_analyze_s2: <... completed>
count

1
step c2: COMMIT;
step pgss_check_explain_analyze_s1:
    SELECT rows FROM pg_stat_statements WHERE query LIKE '%get_execution_time%' and mean_time > 5000;

rows

1
